# ------------------------------ Config parsing------------------------- #
configfile: "config/config.yaml"

# ------------------------------ Include Snakefiles ------------------------- #
include: "rules/common.smk"
include: "rules/1_fastqc.smk"
include: "rules/2_trimming.smk"
#include: "rules/3_assembly.smk"
#include: "rules/4_length_filtering.smk"
#include: "rules/5_clustering.smk"
#include: "rules/6_wtp.smk"
# ------------------------------ Targets ------------------------------------ #

samples_df = samplesheet_to_df(config['samplesheet'])

FRACTIONS = samples_df['fraction'].unique().tolist()
VIRAL_SAMPLES = samples_df.loc[samples_df.fraction == 'viral', 'sample_id'].values.tolist()
MICROBIAL_SAMPLES = samples_df.loc[samples_df.fraction == 'microbial', 'sample_id'].values.tolist()

rule all:
    input:
        expand([
            "results/{fraction}/multiqc_before.html",
            "results/{fraction}/multiqc_after.html",
            ],
            fraction=FRACTIONS),
        expand("results/{fraction}/trim/{sample}.trimmomatic_summary.txt",
                fraction=['viral'], sample=VIRAL_SAMPLES),
        expand("results/{fraction}/trim/{sample}.trimmomatic_summary.txt",
                fraction=['microbial'], sample=MICROBIAL_SAMPLES)


       # expand("../tmp/spades/virus/{virus_sample}/scaffolds.fasta", virus_sample = virus_samples),
       # expand("../results/scaffolds/virus_by_sample/{virus_sample}_scaffolds.fasta", virus_sample = virus_samples),
       # "../results/scaffolds/virus_by_length/virus_scaffolds_all.fasta",
       # "../results/scaffolds/virus_by_length/virus_scaffolds_gt1500.fasta",
       # expand("../tmp/spades/microbe/{microbe_sample}/scaffolds.fasta", microbe_sample = microbe_samples),
       # expand("../results/scaffolds/microbe_by_sample/{microbe_sample}_scaffolds.fasta", microbe_sample = microbe_samples),
       # "../results/scaffolds/microbe_by_length/microbe_scaffolds_all.fasta",
       # "../results/scaffolds/microbe_by_length/microbe_scaffolds_gt1500.fasta",
       # "../results/clustering/virus_to_microbe_all_minimap_clustering.paf",
       # "../results/clustering/microbe_to_virus_all_minimap_clustering.paf",
       # "../results/wtp/microbe/microbe_scaffolds_gt1500/identified_contigs_by_tools/deepvirfinder.txt",
       # "../results/wtp/microbe/microbe_scaffolds_gt1500/literature/Citations.bib"
